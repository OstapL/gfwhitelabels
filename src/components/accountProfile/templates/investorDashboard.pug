//include ../../../templates/fields_mixins.pug

mixin investment(i, attr)
  -
    if (!attr)
      attr = {};

    if (!i.campaign)
      return;

  .one_table
    .img_column.text-lg-center.text-sm-center
      - var data = i.campaign.header_image_data[0] || { urls: []};
      - var url = data.urls[0] || "/img/test.png";
      img(src=url alt="").img-fluid
      if attr.active
        span.img_tab #{daysLeft(i.campaign.expiration_date) + ' Days Left'}
      else
        span.successfull.unsuccessfull  Unsuccessfully funded campaign
        span.end-date  #{i.campaign.expiration_date.toLocaleDateString()}
      p.text-uppercase #{i.company.name}
    .right-columns
      .one_line
        .col40
          span.light_grey Amount Invested
        .col60
          span.bold-grey.font-weight-bold #{$formatAmount(i.amount)}
      .one_line
        .col40
          span.light_grey Investment Day
        .col60
          span.dark_grey #{i.created_date.toLocaleDateString() }
      .one_line
        .col40
          span.light_grey Investment ID
        .col60
          span.dark_grey #{i.id}
      .one_line
        .col40
          span.light_grey Security
        .col60
          span.dark_grey #{i.security_type == 0 ? 'Common Equity' : 'Revenue Share'}
      .one_line
        .col40
          span.light_grey Perks
        .col60
          span.dark_grey #{i.perk}
    .right_buttons
      h4 Downloadable Files
      ul
        li
          a(href="#" ).link-3 Investor Presentation
        li
          a(href="#").link-3 Form C
        li
          a(href="#").link-3 Financials
        li
          a(href="#").link-3 Agreement
    .bottom_column
      .top_descript
        .left_text
          b #{$formatAmount(i.amount)}
          span Raised
        .right_text
          b #{$formatAmount((i.campaign.minimum_raise || i.campaign.maximum_raise))}
          span Goal
        p.percents #{percentage(i.amount, i.campaign.minimum_raise || i.campaign.maximum_raise) + '% Funded'}
        .clear
      .progress_line_container
        progress(value=i.amount max=(i.campaign.minimum_raise || i.campaign.maximum_raise)).progress
      .text-lg-center
        a(href=('/' + i.company.id)).btn.btn-sm.btn-secondary.text-uppercase view campaign
          i.fa.fa-angle-right
      .cancel_invest
        if attr.active
          a(
            href="#"
            data-id=(i.id || 0)
          ).cancel-investment.font-weight-bold Cancel investment
    .clear

-
  function $formatAmount(amount) {
    if (amount < 1000)
      return '$' + amount;

    if (amount < 1000000)
      return '$' + Math.round(amount/1000) + 'K';

    if (amount < 1000000000)
      return '$' + (amount/1000000).toFixed(3) + 'M';

    return '$' + (amount / 1000000000).toFixed(2) + 'MM';
  };

  function percentage(amount, goal) {
    return Math.round((amount / goal) * 100);
  };

  function daysLeft(end) {
  var today = new Date();
  var days = Math.ceil((end.valueOf() - today.valueOf()) / ( 1000 * 60 * 60 * 24));
    var res = days < 10 ? '0' + days : days.toString();
    console.log(res);
    return res;
  };

  function toDate(dateStr) {
    return new Date(dateStr);
  };

- pug_html += app.breadcrumbs('investor dashboard', '', [ ['Home', '/'], ['investor dashboard', ''],]);


section.investor-dashboard
  .container
    .col-lg-12
      if (!active || !active.length) && (!historical || !historical.length)
        div(role="alert").alert.alert-warning
          strong You have not invested yet
      else
        select.orderby.custom-select.pull-right.text-uppercase
          option(checked="checked" value="0") default sorting
        ul(role="tablist").nav.standart-nav-tabs.row
          li.nav-item
            a.nav-link.text-uppercase.active#active-tab(
              data-toggle="tab"
              href="#active"
              role="tab"
              aria-controls="active"
              aria-expanded="true"
            ) active
          li.nav-item
            a.nav-link.text-uppercase#historical-tab(
              data-toggle="tab"
              href="#historical"
              role="tab"
              aria-controls="historical"
              aria-expanded="false"
            ) Historical
              .clearfix

        .row
          .tab-content
            .tab-pane.fade.active.in#active(
              role="tabpanel"
              aria-labelledby="active-tab"
              aria-expanded="true"
            )
              .active-investor-dashboard.investor_table
                each i in active
                  +investment(i, { active: true })
                else
                  div(role="alert").alert.alert-warning
                    strong You have no active investments

            .tab-pane.fade#historical(
              role="tabpanel"
              aria-labelledby="historical-tab"
              aria-expanded="false"
            )
              .active-investor-dashboard.investor_table
                each i in historical
                  +investment(i, {})
                else
                  div(role="alert").alert.alert-warning
                    strong You have no historical investments
              //
                .one_table
                  .img_column.text-lg-center.text-sm-center
                    img(src="/img/test.png" alt="").img-fluid
                    span.successfull.unsuccessfull  Unsuccessfully funded campaign
                    span.end-date  03.07.2016 End Date
                    p.text-uppercase Company name
                  .right-columns
                    .one_line
                      .col40
                        span.light_grey Amount Invested
                      .col60
                        span.bold-grey.font-weight-bold $25K
                    .one_line
                      .col40
                        span.light_grey Investment Day
                      .col60
                        span.dark_grey 06.15.2016
                    .one_line
                      .col40
                        span.light_grey Investment ID
                      .col60
                        span.dark_grey 09879*****
                    .one_line
                      .col40
                        span.light_grey Security
                      .col60
                        span.dark_grey Revenue Share
                    .one_line
                      .col40
                        span.light_grey Perks
                      .col60
                        span.dark_grey Rewards
                  .right_buttons
                    h4 Downloadable Files
                    ul
                      li
                        a(href="#").link-3 Investor Presentation
                      li
                        a(href="#").link-3 Form C
                      li
                        a(href="#").link-3 Financials
                      li
                        a(href="#").link-3 Agreement
                  .bottom_column
                    .top_descript
                      .left_text
                        b $1,5MM
                        span Raised
                      .right_text
                        b $500K
                        span Goal
                      p.percents 150% Funded
                      .clear
                    .progress_line_container
                      progress(value="10" max="100").progress
                    .text-lg-center
                      a(href="#").btn.btn-sm.btn-secondary.text-uppercase view campaign
                        i.fa.fa-angle-right
                    .cancel_invest
                      a(href="#").font-weight-bold Cancel investment

