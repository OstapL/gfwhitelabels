machine:
    node:
      version: 6.1.0

dependencies:
    override:
        - npm install
        - git submodule init
        - git submodule update
        - git submodule foreach git pull origin master
        - cd staticdata && git checkout `echo $CIRCLE_BRANCH | sed -e 's/ostap/alpha/g' | sed -e 's/chagin/alpha/g'`
        - cd ..
        - ls -la 
        - NODE_ENV=production ./node_modules/webpack/bin/webpack.js -p --config ./webpack.config.js
        - sudo apt-get update
        - sudo apt-get install python-dev
        - sudo pip install awscli
        - ls -la dist
        - ./deploy.sh
        - export NODE_PATH="`pwd`/src"
    
    cache_directories:
        - "node_modules"

general:
    branches:
        ignore:
            - test

deployment:
    aws:
        branch: master
        commands:
            - ./deploy.sh
